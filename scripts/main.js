function randomInRange(e,t){return Math.floor(Math.random()*(1+t-e))+e}function plusOrMinus(){return Math.random()>.5?1:-1}function Game(){this.state=STATE.IDLE,this.score=0,this.objects=[],this.duration=DURATION.game,this.level=1,this.soundFX=new SoundFX}function Character(e,t,n,i){var s=30,o=e.board.image("images/characters/"+t+".png",n,i,s,s);o.type=t,o.direction=Math.random()*plusOrMinus(),o.moveTurn=randomInRange(0,50);var a=plusOrMinus(),r=plusOrMinus();return o.move=function(e,t,n){var i=parseInt(o.attr("x")),u=parseInt(o.attr("y"));50==++o.moveTurn&&(o.moveTurn=0,a=plusOrMinus(),r=plusOrMinus()),delX=a*n*MOVEMENT_CHARACTER[o.type].speedX,delY=r*n*MOVEMENT_CHARACTER[o.type].speedY,i+=delX,u+=delY,(s>i||i>e-s)&&(i-=2*delX,a*=plusOrMinus(),r*=plusOrMinus()),(s>u||u>t-s)&&(u-=2*delY,a*=plusOrMinus(),r*=plusOrMinus()),o.attr("x",i),o.attr("y",u)},o}function SoundFX(){Object.keys(SOUNDFX).forEach(function(e){var t=SOUNDFX[e];createjs.Sound.registerSound(t,e)}),this.play=function(e){createjs.Sound.play(e)}}var IDCANVAS="#game-board",STATE={IDLE:0,SELECTING:1,WAITING:2,TIMEUP:3},DURATION={selecting:1e3,waiting:1e3,game:180},LEVEL_SETTING={1:{objects:{cat:2,dog:2}},2:{objects:{cat:1,dog:1}}},MAX_LEVEL=Object.keys(LEVEL_SETTING).splice(-1,1),MOVEMENT_CHARACTER={dog:{speedX:5,speedY:5},cat:{speedX:6,speedY:6}},SOUNDFX={addObject:"https://www.freesound.org/data/previews/21/21389_36084-lq.mp3"};Game.prototype.init=function(){this.board=Snap(IDCANVAS),this.sepLine=this.board.line(0,0,0,600),this.sepLine.addClass("separate-line"),document.getElementById("time").innerHTML=this.duration,this.initEvents(),this.setupLevel(),this.initObjectMovement(),this.start()},Game.prototype.initEvents=function(){function e(){t.sepLine.animate({opacity:0},DURATION.selecting,function(){t.sepLine.removeClass("show"),t.sepLine.attr("opacity",1),t.setState("waiting"),setTimeout(function(){t.setState("idle")},DURATION.waiting)})}var t=this;this.board.drag(function(n,i,s,o){if(t.state==STATE.WAITING)return void console.log("Please wait a little bit.");t.sepLine.addClass("show"),t.setState("selecting"),e();for(var a=[0,600],r=0;r<a.length;r++){var u="x"+(r+1);a[r]=n/i*(a[r]-t.sepLine.originY)+t.sepLine.originX,t.sepLine.attr(u,a[r])}},function(e,n){t.sepLine.originX=e,t.sepLine.originY=n},function(n,i){t.setState("waiting"),t.state==STATE.SELECTING&&e()}),window.addEventListener("keyup",function(n){"32"==n.keyCode&&t.state==STATE.SELECTING&&(t.computeScore(),t.setState("waiting"),e())},!1)},Game.prototype.initObjectMovement=function(){var e=this;setInterval(function(){if(e.state!=STATE.TIMEUP){var t=.5;e.state==STATE.SELECTING&&(t=.02);for(var n=0;n<e.objects.length;n++)e.objects[n].move(e.board.node.offsetWidth,e.board.node.offsetHeight,t)}},50)},Game.prototype.start=function(){var e=this;e.timer=setInterval(function(){var t=e.duration--;document.getElementById("time").innerHTML=t,0==t&&e.stop()},1e3)},Game.prototype.stop=function(){clearInterval(this.timer),this.setState("timeup")},Game.prototype.setupLevel=function(){var e=this,t=LEVEL_SETTING[this.level];console.log(t.objects),Object.keys(t.objects).forEach(function(n){for(var i=0;i<t.objects[n];i++){e.soundFX.play("addObject");var s=new Character(e,n,randomInRange(15,e.board.node.offsetWidth-15),randomInRange(15,e.board.node.offsetHeight-15));e.objects.push(s)}})},Game.prototype.setState=function(e){var t=e.toUpperCase();if(-1==Object.keys(STATE).indexOf(t))throw new Error("This state doesn't exist : "+t);this.state=STATE[e.toUpperCase()]},Game.prototype.computeScore=function(){var e=1e3;this.score+=e,document.getElementById("scoreboard").innerHTML=this.score},Game.prototype.nextLevel=function(){this.level=this.level+1,this.level>MAX_LEVEL&&(this.level=MAX_LEVEL),this.setupLevel()},Game.prototype.loadSound=function(){};var game=new Game;game.init();