function randomInRange(e,t){return Math.floor(Math.random()*(1+t-e))+e}function plusOrMinus(){return Math.random()>.5?1:-1}function Game(){this.state=STATE.IDLE,this.score=0,this.objects=[],this.duration=DURATION.game,this.level=1,this.soundFX=new SoundFX,this.prevState="idle"}function Character(e,t,i,s){var n=30,o=e.board.image("images/characters/"+t+".png",i,s,n,n);o.type=t,o.direction=Math.random()*plusOrMinus(),o.moveTurn=randomInRange(0,50);var a=plusOrMinus(),r=plusOrMinus();return o.move=function(e,t,i){var s=parseInt(o.attr("x")),p=parseInt(o.attr("y"));50==++o.moveTurn&&(o.moveTurn=0,a=plusOrMinus(),r=plusOrMinus()),delX=a*i*MOVEMENT_CHARACTER[o.type].speedX,delY=r*i*MOVEMENT_CHARACTER[o.type].speedY,s+=delX,p+=delY,(n>s||s>e-n)&&(s-=2*delX,a*=plusOrMinus(),r*=plusOrMinus()),(n>p||p>t-n)&&(p-=2*delY,a*=plusOrMinus(),r*=plusOrMinus()),o.attr("x",s),o.attr("y",p)},o}function SoundFX(){Object.keys(SOUNDFX).forEach(function(e){var t=SOUNDFX[e];createjs.Sound.registerSound(t,e)}),this.play=function(e){createjs.Sound.play(e)}}var IDCANVAS="#game-board",BASE_SCORE=10,STATE={IDLE:0,SELECTING:1,WAITING:2,TIMEUP:3},DURATION={selecting:1e3,waiting:1e3,game:180},LEVEL_SETTING={1:{objects:{cat:2,dog:2}},2:{objects:{cat:2,dog:2}}},MAX_LEVEL=Object.keys(LEVEL_SETTING).splice(-1,1),MOVEMENT_CHARACTER={dog:{speedX:5,speedY:5},cat:{speedX:6,speedY:6}},SOUNDFX={addObject:"https://www.freesound.org/data/previews/21/21389_36084-lq.mp3"};Game.prototype.init=function(){this.board=Snap(IDCANVAS),this.sepLine=this.board.line(0,0,0,600),this.sepLine.addClass("separate-line"),document.getElementById("time").innerHTML=this.duration,this.initEvents(),this.setupLevel(),this.initObjectMovement(),this.start()},Game.prototype.initEvents=function(){function e(){t.sepLine.animate({opacity:0},DURATION.selecting,function(){t.sepLine.removeClass("show"),t.sepLine.attr("opacity",1),t.setState("waiting"),setTimeout(function(){t.setState("idle")},DURATION.waiting)})}var t=this;this.board.drag(function(i,s,n,o){if(t.sepLine.dx=i,t.sepLine.dy=s,t.state==STATE.WAITING)return void console.log("Please wait a little bit.");t.sepLine.addClass("show"),t.setState("selecting"),e();for(var a=[0,600],r=0;r<a.length;r++){var p="x"+(r+1);a[r]=i/s*(a[r]-t.sepLine.originY)+t.sepLine.originX,t.sepLine.attr(p,a[r])}},function(e,i){t.state!=STATE.waiting&&t.state!=STATE.TIMEUP&&(t.sepLine.originX=e,t.sepLine.originY=i)},function(i,s){t.setState("waiting"),t.state==STATE.SELECTING&&e()}),window.addEventListener("keyup",function(i){"32"==i.keyCode&&t.state==STATE.SELECTING&&t.state!=STATE.TIMEUP&&(t.computeScore(),t.setState("waiting"),e())},!1)},Game.prototype.initObjectMovement=function(){var e=this;setInterval(function(){var t=.5;e.state==STATE.SELECTING&&(t=.02);for(var i=0;i<e.objects.length;i++)e.objects[i].move(e.board.node.offsetWidth,e.board.node.offsetHeight,t)},50)},Game.prototype.start=function(){var e=this;e.timer=setInterval(function(){var t=e.duration--;document.getElementById("time").innerHTML=t,0==t&&e.stop()},1e3)},Game.prototype.stop=function(){clearInterval(this.timer),this.setState("timeup"),this.board.undrag()},Game.prototype.setupLevel=function(){var e=this,t=this.level;this.level>MAX_LEVEL&&(t=MAX_LEVEL);var i=LEVEL_SETTING[t];console.log(i.objects),Object.keys(i.objects).forEach(function(t){for(var s=0;s<i.objects[t];s++){e.soundFX.play("addObject");var n=new Character(e,t,randomInRange(15,e.board.node.offsetWidth-15),randomInRange(15,e.board.node.offsetHeight-15));e.objects.push(n)}})},Game.prototype.setState=function(e){var t=e.toUpperCase();if(-1==Object.keys(STATE).indexOf(t))throw new Error("This state doesn't exist : "+t);this.board.removeClass(this.prevState),this.state=STATE[e.toUpperCase()],this.board.addClass(e),this.prevState=e},Game.prototype.computeScore=function(){var e=BASE_SCORE,t=this.sepLine.originX,s=this.sepLine.originY,n=this.sepLine.dx,o=this.sepLine.dy,a=t-n,r=0==a?1:(s-o)/a,p=0==a?-t:s-r*t,c=0,d=0,u=0,h=0;for(i=0;i<this.objects.length;++i){var l=this.objects[i].attr("x"),E=this.objects[i].attr("y"),v=0;v=0==a?l-p:l*r-E+p,console.log("Object type: ",this.objects[i].type),v>=0?"cat"==this.objects[i].type?h++:d++:"cat"==this.objects[i].type?h--:d--}var T=Math.abs(h-u)+Math.abs(d-c);e-=T,0>e&&(e=0),this.score+=e;var m=15*Math.pow(this.level,2);this.score>m?this.nextLevel():console.log("Next Level Score: ",m),document.getElementById("scoreboard").innerHTML=this.score},Game.prototype.nextLevel=function(){this.level=this.level+1,this.setupLevel()},Game.prototype.loadSound=function(){};var game=new Game;game.init();