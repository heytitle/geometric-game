function randomInRange(e,t){return Math.floor(Math.random()*(1+t-e))+e}function plusOrMinus(){return Math.random()>.5?1:-1}function checkLeftOrRight(e,t,n,o,s,i){return(n-e)*(i-t)-(o-t)*(s-e)}function setTextForDOM(e,t){document.getElementById(e).innerHTML=t}function hideDOM(e){console.log(e),document.getElementById(e).style.display="none"}function showDOM(e,t){t=t||"block",document.getElementById(e).style.display=t}function Game(){this.soundFX=new SoundFX,this.board=Snap(IDCANVAS),this.sepLine=this.board.line(0,0,0,600),this.sepLine.addClass("separate-line")}function Character(e,t,n,o){var s=30,i=e.board.image("images/characters/"+t+".png",n,o,s,s);i.type=t,i.direction=Math.random()*plusOrMinus(),i.moveTurn=randomInRange(0,50);var a=plusOrMinus(),r=plusOrMinus();return i.move=function(e,t,n){var o=parseInt(i.attr("x")),c=parseInt(i.attr("y"));50==++i.moveTurn&&(i.moveTurn=0,a=plusOrMinus(),r=plusOrMinus()),delX=a*n*MOVEMENT_CHARACTER[i.type].speedX,delY=r*n*MOVEMENT_CHARACTER[i.type].speedY,o+=delX,c+=delY,(s>o||o>e-s)&&(o-=2*delX,a*=plusOrMinus(),r*=plusOrMinus()),(s>c||c>t-s)&&(c-=2*delY,a*=plusOrMinus(),r*=plusOrMinus()),i.attr("x",o),i.attr("y",c)},i}function SoundFX(){Object.keys(SOUNDFX).forEach(function(e){var t=SOUNDFX[e];createjs.Sound.registerSound(t,e)}),this.play=function(e){createjs.Sound.play(e)}}function startGame(){hideDOM("control-pane"),hideDOM("start-pane"),showDOM("end-pane","table"),game.init()}function replay(){hideDOM("control-pane"),game.replay()}var IDCANVAS="#game-board",BASE_SCORE=10,STATE={IDLE:0,SELECTING:1,WAITING:2,TIMEUP:3},DURATION={selecting:1e3,waiting:1e3,game:60},LEVEL_SETTING={1:{objects:{cat:2,dog:2}},2:{objects:{cat:2,dog:2}}},MAX_LEVEL=Object.keys(LEVEL_SETTING).splice(-1,1),MOVEMENT_CHARACTER={dog:{speedX:5,speedY:5},cat:{speedX:6,speedY:6}},SOUNDFX={addObject:"https://www.freesound.org/data/previews/21/21389_36084-lq.mp3",awesome:"https://www.freesound.org/data/previews/187/187925_3140412-lq.mp3","oh-no":"http://freesound.org/data/previews/131/131409_2337290-lq.mp3"};Game.prototype.init=function(){this.setupEnvironment(),this.initEvents(),this.setupLevel(),this.initObjectMovement(),document.getElementById("time").innerHTML=this.duration,this.start()},Game.prototype.replay=function(){for(var e=0;e<this.objects.length;e++)this.objects[e].remove();this.init()},Game.prototype.setupEnvironment=function(){this.duration=DURATION.game,this.state=STATE.IDLE,this.score=0,this.objects=[],this.level=1,this.prevState="idle",setTextForDOM("scoreboard",this.score)},Game.prototype.initEvents=function(){function e(){t.sepLine.animate({opacity:0},DURATION.selecting,function(){t.sepLine.removeClass("show"),t.sepLine.attr("opacity",1),t.setState("waiting"),setTimeout(function(){t.setState("idle")},DURATION.waiting)})}var t=this;this.board.drag(function(n,o,s,i){if(console.log(t.state),t.sepLine.dx=n,t.sepLine.dy=o,console.log("dx and dy",t.sepLine.dx+" "+t.sepLine.dy),t.state==STATE.WAITING)return void console.log("Please wait a little bit.");t.sepLine.addClass("show"),t.setState("selecting"),e();for(var a=[0,600],r=0;r<a.length;r++){var c="x"+(r+1);a[r]=n/o*(a[r]-t.sepLine.originY)+t.sepLine.originX,t.sepLine.attr(c,a[r])}},function(e,n){t.state!=STATE.waiting&&t.state!=STATE.TIMEUP&&(t.sepLine.originX=e,t.sepLine.originY=n)},function(n,o){return Math.abs(t.dx)<3||Math.abs(t.dy)<3?(console.log("small line"),void(t.state==STATE.SELECTING&&e())):(t.computeScore(),t.state==STATE.SELECTING&&e(),t.sepLine.dx=0,void(t.sepLine.dy=0))})},Game.prototype.initObjectMovement=function(){var e=this;this.movement_timer=setInterval(function(){var t=.5;e.state==STATE.SELECTING&&(t=.02);for(var n=0;n<e.objects.length;n++)e.objects[n].move(e.board.node.offsetWidth,e.board.node.offsetHeight,t)},50)},Game.prototype.start=function(){var e=this;e.timer=setInterval(function(){var t=e.duration--;document.getElementById("time").innerHTML=t,0==t&&e.stop()},1e3)},Game.prototype.stop=function(){clearInterval(this.timer),clearInterval(this.movement_timer),this.setState("timeup"),setTextForDOM("final-score",this.score),showDOM("control-pane")},Game.prototype.setupLevel=function(){var e=this,t=this.level;this.level>MAX_LEVEL&&(t=MAX_LEVEL);var n=LEVEL_SETTING[t];console.log(n.objects),Object.keys(n.objects).forEach(function(t){for(var o=0;o<n.objects[t];o++){e.soundFX.play("addObject");var s=new Character(e,t,randomInRange(15,e.board.node.offsetWidth-15),randomInRange(15,e.board.node.offsetHeight-15));e.objects.push(s)}})},Game.prototype.setState=function(e){var t=e.toUpperCase();if(console.log(t),-1==Object.keys(STATE).indexOf(t))throw new Error("This state doesn't exist : "+t);this.board.removeClass(this.prevState),this.state=STATE[e.toUpperCase()],this.board.addClass(e),this.prevState=e},Game.prototype.computeScore=function(){console.log("scoringgg");for(var e=this.objects.length/2,t=this.sepLine.originX,n=this.sepLine.originY,o=t+this.sepLine.dx,s=n+this.sepLine.dy,i={left:[],right:[]},a=0;a<this.objects.length;++a){var r=this.objects[a],c=r.attr("x"),p=r.attr("y"),l="right",d=checkLeftOrRight(t,n,o,s,c,p);d>0&&(l="left"),i[l][r.type]||(i[l][r.type]=0),i[l].push(r),i[l][r.type]++}var h=i.left.dog?i.left.dog:0,u=i.right.dog?i.right.dog:0,m=i.left.cat?i.left.cat:0,g=i.right.cat?i.right.cat:0,f=Math.abs(g-m)+Math.abs(u-h);0==f?this.soundFX.play("awesome"):this.soundFX.play("oh-no"),e-=f,0>e&&(e=0),this.score+=e;var v=BASE_SCORE*Math.pow(this.level,2);this.score>v?this.nextLevel():console.log("Next Level Score: ",v),document.getElementById("scoreboard").innerHTML=this.score},Game.prototype.nextLevel=function(){this.level=this.level+1,this.setupLevel()},Game.prototype.loadSound=function(){};var game=new Game;