function randomInRange(t,e){return Math.floor(Math.random()*(1+e-t))+t}function plusOrMinus(){return Math.random()>.5?1:-1}function checkLeftOrRight(t,e,i,n,s,o){return(i-t)*(o-e)-(n-e)*(s-t)}function Game(){this.state=STATE.IDLE,this.score=0,this.objects=[],this.duration=DURATION.game,this.level=1,this.soundFX=new SoundFX,this.prevState="idle"}function Character(t,e,i,n){var s=30,o=t.board.image("images/characters/"+e+".png",i,n,s,s);o.type=e,o.direction=Math.random()*plusOrMinus(),o.moveTurn=randomInRange(0,50);var a=plusOrMinus(),r=plusOrMinus();return o.move=function(t,e,i){var n=parseInt(o.attr("x")),c=parseInt(o.attr("y"));50==++o.moveTurn&&(o.moveTurn=0,a=plusOrMinus(),r=plusOrMinus()),delX=a*i*MOVEMENT_CHARACTER[o.type].speedX,delY=r*i*MOVEMENT_CHARACTER[o.type].speedY,n+=delX,c+=delY,(s>n||n>t-s)&&(n-=2*delX,a*=plusOrMinus(),r*=plusOrMinus()),(s>c||c>e-s)&&(c-=2*delY,a*=plusOrMinus(),r*=plusOrMinus()),o.attr("x",n),o.attr("y",c)},o}function SoundFX(){Object.keys(SOUNDFX).forEach(function(t){var e=SOUNDFX[t];createjs.Sound.registerSound(e,t)}),this.play=function(t){createjs.Sound.play(t)}}var IDCANVAS="#game-board",BASE_SCORE=10,STATE={IDLE:0,SELECTING:1,WAITING:2,TIMEUP:3},DURATION={selecting:1e3,waiting:1e3,game:180},LEVEL_SETTING={1:{objects:{cat:2,dog:2}},2:{objects:{cat:2,dog:2}}},MAX_LEVEL=Object.keys(LEVEL_SETTING).splice(-1,1),MOVEMENT_CHARACTER={dog:{speedX:5,speedY:5},cat:{speedX:6,speedY:6}},SOUNDFX={addObject:"https://www.freesound.org/data/previews/21/21389_36084-lq.mp3"};Game.prototype.init=function(){this.board=Snap(IDCANVAS),this.sepLine=this.board.line(0,0,0,600),this.sepLine.addClass("separate-line"),document.getElementById("time").innerHTML=this.duration,this.initEvents(),this.setupLevel(),this.initObjectMovement(),this.start()},Game.prototype.initEvents=function(){function t(){e.sepLine.animate({opacity:0},DURATION.selecting,function(){e.sepLine.removeClass("show"),e.sepLine.attr("opacity",1),e.setState("waiting"),setTimeout(function(){e.setState("idle")},DURATION.waiting)})}var e=this;this.board.drag(function(i,n,s,o){if(e.sepLine.dx=i,e.sepLine.dy=n,e.state==STATE.WAITING)return void console.log("Please wait a little bit.");e.sepLine.addClass("show"),e.setState("selecting"),t();for(var a=[0,600],r=0;r<a.length;r++){var c="x"+(r+1);a[r]=i/n*(a[r]-e.sepLine.originY)+e.sepLine.originX,e.sepLine.attr(c,a[r])}},function(t,i){e.state!=STATE.waiting&&e.state!=STATE.TIMEUP&&(e.sepLine.originX=t,e.sepLine.originY=i)},function(i,n){e.setState("waiting"),e.state==STATE.SELECTING&&t()}),window.addEventListener("keyup",function(i){"32"==i.keyCode&&e.state==STATE.SELECTING&&e.state!=STATE.TIMEUP&&(e.computeScore(),e.setState("waiting"),t())},!1)},Game.prototype.initObjectMovement=function(){var t=this;setInterval(function(){var e=.5;t.state==STATE.SELECTING&&(e=.02);for(var i=0;i<t.objects.length;i++)t.objects[i].move(t.board.node.offsetWidth,t.board.node.offsetHeight,e)},50)},Game.prototype.start=function(){var t=this;t.timer=setInterval(function(){var e=t.duration--;document.getElementById("time").innerHTML=e,0==e&&t.stop()},1e3)},Game.prototype.stop=function(){clearInterval(this.timer),this.setState("timeup"),this.board.undrag()},Game.prototype.setupLevel=function(){var t=this,e=this.level;this.level>MAX_LEVEL&&(e=MAX_LEVEL);var i=LEVEL_SETTING[e];console.log(i.objects),Object.keys(i.objects).forEach(function(e){for(var n=0;n<i.objects[e];n++){t.soundFX.play("addObject");var s=new Character(t,e,randomInRange(15,t.board.node.offsetWidth-15),randomInRange(15,t.board.node.offsetHeight-15));t.objects.push(s)}})},Game.prototype.setState=function(t){var e=t.toUpperCase();if(-1==Object.keys(STATE).indexOf(e))throw new Error("This state doesn't exist : "+e);this.board.removeClass(this.prevState),this.state=STATE[t.toUpperCase()],this.board.addClass(t),this.prevState=t},Game.prototype.computeScore=function(){var t=this.objects.length,e=this.sepLine.originX,n=this.sepLine.originY,s=e+this.sepLine.dx,o=n+this.sepLine.dy,a={left:[],right:[]};for(i=0;i<this.objects.length;++i){var r=this.objects[i],c=r.attr("x"),p=r.attr("y"),d="right",h=checkLeftOrRight(e,n,s,o,c,p);h>0&&(d="left"),a[d][r.type]||(a[d][r.type]=0),a[d].push(r),a[d][r.type]++}var u=a.left.dog?a.left.dog:0,l=a.right.dog?a.right.dog:0,E=a.left.cat?a.left.cat:0,g=a.right.cat?a.right.cat:0,f=Math.abs(g-E)+Math.abs(l-u);t-=f,0>t&&(t=0),this.score+=t;var v=BASE_SCORE*Math.pow(this.level,2);this.score>v?this.nextLevel():console.log("Next Level Score: ",v),document.getElementById("scoreboard").innerHTML=this.score},Game.prototype.nextLevel=function(){this.level=this.level+1,this.setupLevel()},Game.prototype.loadSound=function(){};var game=new Game;game.init();